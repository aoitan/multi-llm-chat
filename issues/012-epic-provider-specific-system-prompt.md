# 012: Epic - プロバイダー別システムプロンプト機能の実装

## 概要

ユーザーがGradio UIおよびCLIのREPLから、LLMプロバイダーごとに異なるシステムプロンプトを設定できるようにする機能を実装します。プロバイダー固有の設定がない場合は、共通のデフォルトプロンプトが使用されます。

## 関連仕様書

- [プロバイダー別システムプロンプト機能 仕様書](../doc/provider_specific_system_prompt_spec.md)

## 受け入れ基準 (Acceptance Criteria)

- **UI (Gradio)**
  - [ ] UIのシステムプロンプト設定エリアがタブ形式（Default, Gemini, OpenAI, Ollama）になっている。
  - [ ] 各タブで、対応するシステムプロンプトを編集・保持できる。
  - [ ] チャット実行時、選択中のプロバイダーに応じたシステムプロンプトが適用される（固有設定があればそれを優先、なければデフォルトを使用）。
- **CLI (REPL)**
  - [ ] `/system set <provider|default> <prompt>` コマンドで、プロバイダー別またはデフォルトのプロンプトを設定できる。
  - [ ] `/system show [provider|default]` コマンドで、設定済みのプロンプト（またはフォールバックの結果）を表示できる。
  - [ ] `/system clear <provider|default>` コマンドで、指定したプロンプト設定を削除できる。
- **共通**
  - [ ] プロバイダー別プロンプトを保持するためのデータ構造が実装されている。
  - [ ] 新機能に関するユニットテストが追加され、すべてのテストがパスする。

## タスク分割 (Sub-tasks)

1.  **Data Structure**: `chat_logic.py` または関連するコアモジュールに、プロバイダー名をキーとするシステムプロンプトの辞書を管理する機能を追加する。
2.  **Core Logic**: チャット履歴を生成する際に、現在のLLMプロバイダー設定を基に、適切なシステムプロンプト（プロバイダー固有またはデフォルト）を選択して組み込むロジックを実装する。
3.  **Web UI**: `webui.py` を修正し、仕様書に記載の通り `gr.Tabs` を用いたUIを実装する。各タブのテキストボックスの状態を管理し、変更をバックエンドに反映させるロジックも含む。
4.  **CLI**: `cli.py` のREPLを修正し、`/system` コマンドを `set`, `show`, `clear` のサブコマンドを持つように拡張し、プロバイダー別の操作を実装する。
5.  **Testing**: `tests/` ディレクトリ内の関連テストファイル（`test_chat_logic.py`, `test_cli.py` 等）に、プロバイダー別プロンプトの選択、適用、フォールバックロジックを検証するユニットテストを追加する。
6.  **Documentation**: `README.md` や関連ドキュメントを更新し、新しいプロバイダー別システムプロンプト機能の使い方を説明する。
