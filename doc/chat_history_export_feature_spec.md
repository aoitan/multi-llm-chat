# 会話履歴ファイル出力（エクスポート）機能 仕様書

## 1. 概要

ユーザーが現在のチャットセッションの会話履歴を、テキストファイルまたはJSON形式でローカルにエクスポートできるようにする機能。WebUIにはボタン、CLIにはコマンドを提供する。

## 2. 背景

- **履歴保存の代替**: ユーザーごとの永続的な履歴保存機能が未実装の段階で、重要な会話内容を失わないための暫定的な手段を提供する。
- **情報活用**: LLMとの有用なやり取りを、他のツールやドキュメントで再利用できるようにする。
- **ユーザーの安心感**: 「せっかくの良いやり取りが消えてしまう」という不安を取り除き、安心してサービスを利用できる環境を提供する。

## 3. 機能要件

- **履歴のエクスポート**: 現在のチャットセッションの全会話履歴をファイルに出力できること。
- **出力形式の選択**: テキスト形式 (`.txt`) とJSON形式 (`.json`) のいずれかを選択できること。
- **簡単な操作**: 直感的で分かりやすい操作でエクスポートを実行できること。
- **非破壊的**: エクスポート操作はチャット履歴やその他の設定に影響を与えないこと。

## 4. UI仕様 (Gradio)

### 4.1. コンポーネント

1.  **「エクスポート」ボタン (`gr.Button`)**
    - **ラベル**: "履歴をエクスポート" (またはアイコン)
    - **配置**: サイドバー、またはチャット履歴表示エリアの近く。
    - **オプション**: 出力形式を選択するドロップダウン (`gr.Dropdown`) をボタンの近くに配置する。
        - 選択肢: "テキスト (.txt)", "JSON (.json)"
        - デフォルト: "JSON (.json)"

### 4.2. 動作イメージ

- ユーザーが「履歴をエクスポート」ボタンをクリックすると、選択された形式で現在の会話履歴がファイルとしてダウンロードされる。
- ファイル名は自動生成される（例: `chat_history_YYYYMMDD_HHMMSS.json` または `chat_history_YYYYMMDD_HHMMSS.txt`）。

## 5. CLI仕様 (REPL)

### 5.1. コマンド

1.  **エクスポートコマンド: `/export`**
    - **書式**: `/export [filename] [--format <format>]`
    - **説明**: 現在の会話履歴をファイルに出力する。
    - **引数**:
        - `filename` (オプション): 出力ファイル名。省略した場合は自動生成される。
        - `--format <format>` (オプション): 出力形式。`text` または `json` を指定。デフォルトは `json`。
    - **例**:
      ```
      > /export my_conversation.json
      Chat history exported to my_conversation.json (JSON format).
      > /export --format text notes.txt
      Chat history exported to chat_history_YYYYMMDD_HHMMSS.txt (Text format).
      > /export
      Chat history exported to chat_history_YYYYMMDD_HHMMSS.json (JSON format).
      ```

### 5.2. 動作イメージ

- ユーザーが `/export` コマンドを実行すると、指定されたファイル名と形式で会話履歴が保存される。
- エクスポートが成功したことを示すメッセージがREPLに表示される。
