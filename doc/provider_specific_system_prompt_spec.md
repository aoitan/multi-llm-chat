# プロバイダー別システムプロンプト機能 仕様書

## 1. 概要

LLMプロバイダー（Google Gemini, OpenAI, Ollama）ごとに、異なるシステムプロンプトを設定できるようにする機能。プロバイダー固有の設定が存在しない場合は、共通のデフォルトプロンプトが適用される。

## 2. 背景

- **役割の最適化**: LLMのモデルやプロバイダーにはそれぞれ得意なタスクがある。システムプロンプトを使い分けることで、「コーディングの専門家」「クリエイティブなライター」など、その能力を最大限に引き出す役割を与えることが可能になる。
- **指示の精度向上**: プロバイダーのAPI仕様や特性に合わせた微細な指示調整（例: 出力形式の指定）を行うことで、より安定した、期待通りの応答を得やすくする。

## 3. 機能要件

- **プロバイダー別設定**: Gemini, OpenAI, Ollama の各プロバイダーに対して、個別のシステムプロンプトを設定できること。
- **デフォルト設定**: いずれのプロバイダーにも属さない、共通の「デフォルト」システムプロンプトを設定できること。
- **フォールバック機構**: チャット実行時、選択中のプロバイダーに固有のプロンプトが設定されていない場合、自動的にデフォルトのプロンプトが使用されること。
- **動的な適用**: UIやCLIでの設定変更は、即座に以降のチャットセッションに反映されること。

## 4. UI仕様 (Gradio)

現在の単一のシステムプロンプト入力欄を、タブUI (`gr.Tabs`) に置き換える。

### 4.1. コンポーネント

1.  **タブコンテナ (`gr.Tabs`)**
    - **配置**: 既存のシステムプロンプト入力エリア。
    - **タブ項目**:
        - `Default`
        - `Gemini`
        - `OpenAI`
        - `Ollama`

2.  **プロンプト入力欄 (`gr.Textbox`)**
    - **配置**: 各タブ内に1つずつ配置される。
    - **ラベル**: "System Prompt"
    - **動作**: 各プロンプトは独立して編集・保持される。

### 4.2. 動作イメージ

- ユーザーはタブを切り替えることで、対象とするプロンプト（デフォルトまたはプロバイダー固有）を編集できる。
- 例えば、`Gemini` を選択してチャットする際、まず `Gemini` タブのプロンプトが参照される。もしその中身が空であれば、`Default` タブのプロンプトがシステムプロンプトとして使用される。

## 5. CLI仕様 (REPL)

既存の `/system` サブコマンドを拡張し、プロバイダー別の設定を可能にする。

1.  **プロンプトの設定: `/system set`**
    - **書式**: `/system set <provider|default> <prompt text>`
    - **説明**: 指定したプロバイダーまたはデフォルトのシステムプロンプトを設定する。
    - **例**:
      ```
      > /system set default あなたは万能なアシスタントです。
      Default system prompt updated.
      > /system set openai あなたはOpenAIのGPT-4oです。簡潔な回答を心がけてください。
      System prompt for 'openai' updated.
      ```

2.  **設定の表示: `/system show`**
    - **書式**: `/system show [provider|default]`
    - **説明**: 設定済みのシステムプロンプトを表示する。引数なしの場合は、設定されている全てのプロンプトを表示する。
    - **例**:
      ```
      > /system show
      - default: あなたは万能なアシスタントです。
      - openai: あなたはOpenAIのGPT-4oです。簡潔な回答を心がけてください。

      > /system show gemini
      Current prompt for 'gemini' (fallback to default):
      あなたは万能なアシスタントです。
      ```

3.  **設定のクリア: `/system clear`**
    - **書式**: `/system clear <provider|default>`
    - **説明**: 指定したプロバイダーのカスタムプロンプトを削除し、デフォルト設定にフォールバックするように戻す。`default` を指定した場合は、デフォルトプロンプトの内容を空にする。
    - **例**:
      ```
      > /system clear openai
      System prompt for 'openai' cleared. It will now use the default prompt.
      ```
