# WebUI 2ペインデザイン仕様書

## 1. 概要と目的

本仕様書は、現在のシングルカラムレイアウトのWebUIを、より多機能で直感的な2ペインデザインに刷新するための要件と設計を定義する。

**目的:**
- **UXの向上:** 会話の「管理」と「実行」の関心事を物理的に分離し、ユーザーの認知負荷を軽減する。
- **機能拡張性:** 将来的に追加される機能を整理しやすいレイアウト基盤を構築する。
- **画面利用効率の改善:** 特にデスクトップ環境において、画面を広く活用できるインターフェースを提供する。

---

## 2. 現状のUI構成 (As-Is)

現在のUIは、すべてのコンポーネントが単一の垂直カラムに上から下へ順に配置されている。

### 2.1. レイアウト

- 単一カラムレイアウト

### 2.2. コンポーネント配置

```
+------------------------------------------+
| # Multi-LLM Chat (Title)                 |
+------------------------------------------+
| [User ID] Textbox                        |
+------------------------------------------+
| [System Prompt] Textbox                  |
+------------------------------------------+
| Tokens: ... (Markdown)                   |
+------------------------------------------+
| ▼ 履歴管理 (Accordion)                   |
|   - [保存済み履歴] Dropdown              |
|   - [保存名] Textbox                     |
|   - [保存] [読み込み] [新規] Buttons     |
|   - Status message (Markdown)            |
+------------------------------------------+
|                                          |
| Chatbot (Display Area)                   |
|                                          |
+------------------------------------------+
| [Enter text...] [Send] [New Chat]        |
+------------------------------------------+
```

### 2.3. 課題

- **視線の流れが複雑:** チャット中にもかかわらず、中段にある履歴管理機能が視界に入り、ノイズとなる。
- **画面の横幅が非効率:** デスクトップ環境では、中央にコンテンツが寄ってしまい、両脇に大きな余白が生まれる。
- **履歴の操作性:** ドロップダウン形式の履歴選択は、履歴件数が増えると目的の会話を探しにくい。

---

## 3. 新しいUI構成 (To-Be)

画面を左右に分割し、左に会話管理、右にチャット実行の機能を配置する。

### 3.1. 基本レイアウト

- **左ペイン (サイドバー):** 会話セッションの管理に特化。開閉可能（フォールダブル）。
- **右ペイン (メインエリア):** アクティブな会話の実行に集中。

```
+--------------------------+---------------------------------+
| [Left Pane] (Sidebar)    | [Right Pane] (Main Content)     |
| (Foldable)               |                                 |
|                          |    [≡] (Menu Button to toggle   |
| [＋ 新しい会話] Button     |       left pane)                |
|                          |                                 |
| - Conversation 1 (Radio) |    Chatbot, Inputs, etc.        |
| - Conversation 2         |                                 |
| - ...                    |                                 |
|                          |                                 |
| ▼ その他操作 (Accordion) |                                 |
+--------------------------+---------------------------------+
```

### 3.2. コンポーネントの再配置

#### **【左ペイン: 会話管理サイドバー】**

- **`gr.Button("＋ 新しい会話")`**
  - 用途: 新しいチャットセッションを開始する。
  - 役割: 既存の `new_chat_btn` と `reset_button` の機能を統合し、最も目立つ位置に配置。
- **`gr.Radio(label="会話履歴")`**
  - 用途: 保存済みの会話履歴を一覧表示し、選択できるようにする。
  - 役割: 既存の `history_dropdown` を置き換え、視認性と選択のしやすさを向上させる。
- **`gr.Button("選択した会話を読み込む")`**
  - 用途: 上記Radioで選択した会話を右ペインにロードする。
  - 役割: 既存の `load_history_btn`。
- **`gr.Accordion("現在の会話を保存・管理", open=False)`**
  - 用途: 使用頻度が比較的低い、現在の会話に対する操作を格納する。
  - **`save_name_input`**: 保存名を入力。
  - **`save_history_btn`**: 現在の会話を保存。
  - **`history_status`**: 保存・読込時のステータスを表示。

#### **【右ペイン: メインチャットエリア】**

- **`gr.Button("≡")`** (仮)
  - 用途: 左ペインの表示・非表示を切り替えるトグルボタン。
- **`user_id_input`**
- **`system_prompt_input`**
- **`token_display`**
- **`chatbot_ui`**
- **`user_input`** & **`send_button`**

### 3.3. 実装方針とUX改善

- **フォールダブルサイドバー:**
  - `gr.Column` の `visible` プロパティと `gr.Button` のクリックイベントを連動させて、左ペインの開閉機能を実現する。
- **関心の分離:**
  - レイアウトレベルで「管理」と「実行」を分離することで、ユーザーは現在のタスク（チャット or 履歴整理）に集中しやすくなる。
- **履歴の視認性向上:**
  - `gr.Radio` を使うことで、会話のタイトルを一覧でき、目的の会話へのアクセスが格段に早くなる。

---
## 4. 段階的実装計画 (案)

1.  **Phase 1: レイアウト骨格の実装**
    - `gr.Row` と `gr.Column` で2ペインの基本構造を作成する。
    - 既存コンポーネントを上記仕様に従って左右に再配置する。
2.  **Phase 2: サイドバー機能の実装**
    - 左ペインの開閉（フォールダブル）機能を実装する。
    - 履歴一覧を `gr.Dropdown` から `gr.Radio` に変更し、読込機能と連携させる。
3.  **Phase 3: UIの洗練**
    - 各コンポーネントのマージンやスタイルを調整し、全体の見た目を整える。
